<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Todo + Notepad</title>
<style>
:root{
  --bg1:#f3f0ff; --bg2:#faf7ff;
  --card:rgba(255,255,255,0.55);
  --border:rgba(255,255,255,0.32);
  --accent:#7b5cfa; 
  --muted:#6e6e7a;
  --ok:#10b981;
}

html,body{
  height:100%; margin:0;
  font-family:Inter,"Noto Sans KR",system-ui;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:#222;
}

.app{
  max-width:1100px;
  margin:28px auto;
  display:grid;
  grid-template-columns:1fr 420px;
  gap:20px; padding:20px;
}

.card{
  backdrop-filter:blur(18px);
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:20px;
  box-shadow:0 8px 20px rgba(80,60,130,0.15);
}

/* Header */
.top-row{display:flex; justify-content:space-between; align-items:center; margin-bottom:14px}
h1{font-size:21px; font-weight:600; margin:0; color:#3a2d58}

/* buttons */
button{
  background:rgba(255,255,255,0.6);
  border:1px solid rgba(255,255,255,0.4);
  color:#4a4a56;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  transition:0.18s;
}
button:hover{background:white; transform:translateY(-1px)}
button.primary{
  background:linear-gradient(90deg,#7b5cfa,#a084ff);
  color:white; border:none;
  box-shadow:0 4px 12px rgba(123,92,250,0.35);
}
button.primary:hover{transform:translateY(-2px)}

/* Todo list */
.todo-item{
  display:flex; gap:10px; align-items:center;
  padding:12px; border-radius:12px;
  background:white;
  border:1px solid rgba(0,0,0,0.05);
  box-shadow:0 3px 9px rgba(0,0,0,0.06);
}
.todo-text.completed{color:#bbb; text-decoration:line-through}

/* Input styling */
.todo-add input,
#search,
.notepad textarea{
  background:white;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.08);
  color:#333; padding:10px 12px;
}

/* Count text */
.count{color:#6a6a74; font-size:14px; margin-top:12px}

@media(max-width:980px){
  .app{grid-template-columns:1fr}
}


  /* responsive */
  @media (max-width:980px){
    .app{grid-template-columns: 1fr; padding:12px}
    .notepad{order:2}
  }
  .hint{color:var(--muted); font-size:13px}
  .hidden{display:none}
  input[type="file"]{display:none}
</style>
</head>
<body>
<div class="app">
  <div class="card" id="todoCard" aria-label="Todo">
    <div class="top-row">
      <h1>ğŸ“ Todo</h1>
      <div class="controls">
        <button id="exportBtn" title="ë‚´ë³´ë‚´ê¸°(JSON)">Export</button>
        <label class="small button-like" for="importFile" style="display:inline-block">
          <button id="importBtn">Import</button>
        </label>
        <input id="importFile" type="file" accept="application/json" />
        <button id="clearAll" class="small ghost" title="ëª¨ë‘ ì‚­ì œ">Clear All</button>
      </div>
    </div>

    <div class="todo-add">
      <input id="todoInput" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ê³  Enter ëˆ„ë¥´ê¸°...">
      <button id="addBtn" class="primary">+</button>
    </div>

    <div style="display:flex; gap:12px; align-items:center; margin-bottom:10px">
      <div class="filters" role="tablist">
        <button data-filter="all" class="active">ì „ì²´</button>
        <button data-filter="active">í™œì„±</button>
        <button data-filter="completed">ì™„ë£Œ</button>
      </div>
      <input id="search" placeholder="ê²€ìƒ‰..." style="flex:1; padding:8px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.04); color:inherit">
    </div>

    <ul id="todoList" class="todo-list" aria-live="polite"></ul>

    <div class="count" id="todoCount">0ê°œ ë‚¨ìŒ</div>
  </div>

  <div class="card notepad" id="noteCard">
    <div class="top-row">
      <h1>ğŸ—’ï¸ ë©”ëª¨ì¥</h1>
      <div class="controls">
        <button id="downloadNote" class="small">ë‹¤ìš´ë¡œë“œ</button>
        <button id="clearNote" class="small ghost">ì§€ìš°ê¸°</button>
      </div>
    </div>

    <div class="note-tools" style="margin-bottom:6px">
      <div class="hint">ìë™ì €ì¥ âœ”</div>
      <div style="flex:1"></div>
      <button id="importTextBtn" class="small">ë¶ˆëŸ¬ì˜¤ê¸°(.txt)</button>
      <input id="importTextFile" type="file" accept="text/plain" />
    </div>

    <textarea id="noteArea" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
  </div>
</div>

<script>
(() => {
  // Storage keys
  const TODO_KEY = 'todo_list_v1';
  const NOTE_KEY = 'simple_note_v1';

  // Elements
  const todoInput = document.getElementById('todoInput');
  const addBtn = document.getElementById('addBtn');
  const todoList = document.getElementById('todoList');
  const filters = document.querySelectorAll('.filters button');
  const searchInput = document.getElementById('search');
  const todoCount = document.getElementById('todoCount');
  const exportBtn = document.getElementById('exportBtn');
  const importFile = document.getElementById('importFile');
  const importBtn = document.getElementById('importBtn');
  const clearAllBtn = document.getElementById('clearAll');

  const noteArea = document.getElementById('noteArea');
  const downloadNote = document.getElementById('downloadNote');
  const clearNote = document.getElementById('clearNote');
  const importTextBtn = document.getElementById('importTextBtn');
  const importTextFile = document.getElementById('importTextFile');

  // State
  let todos = []; // {id, text, done}
  let filter = 'all';
  let draggingEl = null;

  // Utilities
  const uid = () => 't'+Math.random().toString(36).slice(2,9);

  const saveTodos = () => localStorage.setItem(TODO_KEY, JSON.stringify(todos));
  const loadTodos = () => {
    try{
      const raw = localStorage.getItem(TODO_KEY);
      todos = raw ? JSON.parse(raw) : [];
    }catch(e){ todos = [] }
  };

  const saveNote = () => localStorage.setItem(NOTE_KEY, noteArea.value);
  const loadNote = () => {
    noteArea.value = localStorage.getItem(NOTE_KEY) || '';
  };

  // Render
  function render(){
    // filter and search
    const q = searchInput.value.trim().toLowerCase();
    const visible = todos.filter(t=>{
      if(filter === 'active' && t.done) return false;
      if(filter === 'completed' && !t.done) return false;
      if(q && !t.text.toLowerCase().includes(q)) return false;
      return true;
    });

    todoList.innerHTML = '';
    visible.forEach(item => {
      const li = document.createElement('li');
      li.className = 'todo-item';
      li.draggable = true;
      li.dataset.id = item.id;

      const chk = document.createElement('input');
      chk.type = 'checkbox';
      chk.checked = !!item.done;
      chk.addEventListener('change', () => {
        item.done = chk.checked;
        saveTodos(); render();
      });

      const span = document.createElement('div');
      span.className = 'todo-text' + (item.done ? ' completed' : '');
      span.textContent = item.text;
      span.title = 'ë”ë¸”í´ë¦­ìœ¼ë¡œ í¸ì§‘';
      span.addEventListener('dblclick', () => startEdit(item, span));

      const actions = document.createElement('div');
      actions.className = 'todo-actions';

      const editBtn = document.createElement('button');
      editBtn.className = 'small';
      editBtn.textContent = 'ìˆ˜ì •';
      editBtn.addEventListener('click', () => startEdit(item, span));

      const delBtn = document.createElement('button');
      delBtn.className = 'small ghost';
      delBtn.textContent = 'ì‚­ì œ';
      delBtn.addEventListener('click', () => {
        todos = todos.filter(t=>t.id !== item.id);
        saveTodos(); render();
      });

      actions.appendChild(editBtn);
      actions.appendChild(delBtn);

      li.appendChild(chk);
      li.appendChild(span);
      li.appendChild(actions);

      // drag events
      li.addEventListener('dragstart', e=>{
        draggingEl = li;
        li.classList.add('dragging');
        e.dataTransfer.effectAllowed = "move";
      });
      li.addEventListener('dragend', ()=>{
        if (draggingEl) draggingEl.classList.remove('dragging');
        draggingEl = null;
      });

      li.addEventListener('dragover', e=>{
        e.preventDefault();
        if(!draggingEl || draggingEl === li) return;
        // insert before or after based on mouse position
        const rect = li.getBoundingClientRect();
        const half = rect.top + rect.height/2;
        const parent = li.parentNode;
        if (e.clientY < half) parent.insertBefore(draggingEl, li);
        else parent.insertBefore(draggingEl, li.nextSibling);
      });

      li.addEventListener('drop', e=>{
        e.preventDefault();
        // rebuild todos order based on DOM
        const ids = Array.from(todoList.children).map(n=>n.dataset.id);
        todos = ids.map(id => todos.find(t=>t.id===id)).filter(Boolean);
        saveTodos(); render();
      });

      todoList.appendChild(li);
    });

    const remaining = todos.filter(t=>!t.done).length;
    todoCount.textContent = `${remaining}ê°œ ë‚¨ìŒ Â· ì´ ${todos.length}ê°œ`;
    // update filter buttons UI
    filters.forEach(btn => btn.classList.toggle('active', btn.dataset.filter === filter));
  }

  function startEdit(item, spanEl){
    const input = document.createElement('input');
    input.type = 'text';
    input.value = item.text;
    input.style.width = '100%';
    input.style.padding = '6px';
    input.style.borderRadius = '6px';
    input.style.border = '1px solid rgba(255,255,255,0.06)';
    spanEl.replaceWith(input);
    input.focus();
    input.select();

    function commit(){
      item.text = input.value.trim() || item.text;
      saveTodos();
      render();
    }
    input.addEventListener('blur', commit);
    input.addEventListener('keydown', e=>{
      if(e.key === 'Enter'){ commit(); }
      if(e.key === 'Escape'){ render(); }
    });
  }

  // Add
  function addTodo(text){
    const t = text.trim();
    if(!t) return;
    todos.unshift({id:uid(), text:t, done:false});
    saveTodos();
    render();
    todoInput.value = '';
    todoInput.focus();
  }

  // Events
  addBtn.addEventListener('click', ()=> addTodo(todoInput.value));
  todoInput.addEventListener('keydown', e=> { if(e.key==='Enter') addTodo(todoInput.value); });

  filters.forEach(btn => {
    btn.addEventListener('click', ()=> {
      filter = btn.dataset.filter;
      render();
    });
  });

  searchInput.addEventListener('input', () => render());

  // Export / Import
  exportBtn.addEventListener('click', () => {
    const data = {todos, note: localStorage.getItem(NOTE_KEY) || ''};
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `todo_note_backup_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  });

  importFile.addEventListener('change', e=>{
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try{
        const data = JSON.parse(ev.target.result);
        if(Array.isArray(data.todos)){
          todos = data.todos;
          saveTodos();
        }
        if(typeof data.note === 'string'){
          localStorage.setItem(NOTE_KEY, data.note);
          loadNote();
        }
        render();
        alert('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
      }catch(err){ alert('íŒŒì¼ì´ ì˜¬ë°”ë¥¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤'); }
    };
    reader.readAsText(f);
    e.target.value = '';
  });

  importBtn.addEventListener('click', ()=> importFile.click());

  clearAllBtn.addEventListener('click', ()=>{
    if(confirm('ì •ë§ë¡œ ëª¨ë“  í•  ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      todos = [];
      saveTodos();
      render();
    }
  });

  // Note features
  let noteTimer = null;
  noteArea.addEventListener('input', () => {
    if(noteTimer) clearTimeout(noteTimer);
    noteTimer = setTimeout(()=>{ saveNote(); noteTimer=null; }, 400);
  });

  downloadNote.addEventListener('click', ()=>{
    const blob = new Blob([noteArea.value], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `note_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.txt`;
    a.click();
    URL.revokeObjectURL(a.href);
  });

  clearNote.addEventListener('click', ()=>{
    if(confirm('ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      noteArea.value = '';
      saveNote();
    }
  });

  importTextBtn.addEventListener('click', ()=> importTextFile.click());
  importTextFile.addEventListener('change', e=>{
    const f = e.target.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ev => { noteArea.value = ev.target.result; saveNote(); };
    r.readAsText(f);
    e.target.value = '';
  });

  // keyboard shortcuts
  window.addEventListener('keydown', e=>{
    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'f'){
      e.preventDefault(); searchInput.focus();
    }
    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n'){
      e.preventDefault(); noteArea.focus();
    }
  });

  // init
  loadTodos();
  loadNote();
  render();

  // autosave on unload
  window.addEventListener('beforeunload', ()=> { saveTodos(); saveNote(); });

})();
</script>
</body>
</html>
